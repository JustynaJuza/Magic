@using Magic.Hubs;

<style>
    .container {
        height: auto;
        width: 100%;
        overflow: hidden;
    }

    .left {
        width: auto;
    }

    .right {
        float: right;
    }

    ul {
        padding: 0px 0px 0px 3px;
    }
</style>

<div class="chat container">

    <h3>Discuss</h3>
    @*Want to ask a question or join in the talk about Magic events? <br />*@

    <div class="container">

        <div class="form-control right" id="chat-users-container" style="margin: 0px 0px 0px 6px; width: 100px; height: 255px; overflow: auto;">
            <ul id="chat-users" style="list-style-type: none; margin: 0px">
                <li class="chat-user" style="font-weight:bold" />
            </ul>
        </div>

        <div class="container left">

            @if (Request.IsAuthenticated)
            {
                //@: Please show class and be polite and respectful towards other people.

                <div class="container" style="margin: 0px 0px 3px 0px; white-space: nowrap;">
                    @*<input type="button" id="room-setting" class="btn btn-primary" value="" style="float: right;" />*@
                    @Html.TextBox("new-chat-message", null, new { id = "new-chat-message", @class = "form-control", style = "width:100%; max-width: 100%; display:inline; margin: 0px -63px 3px 0px; padding-right: 67px" })
                    <input type="button" id="new-chat-message-send" class="btn btn-primary" value="Send" style="width: 60px; display: inline; margin: 0px 0px 3px 0px;" />
                </div>
            }
            else
            {
                //@: Log in to take part in the chat conversation with other users!
            }

            <div class="form-control" id="chat-messages-container" style="height: 215px; overflow: auto;">
                <ul id="chat-messages" style="list-style-type: none;">
                    @{ var recentLog = ChatHub.GetRecentChatLog();
                     if (recentLog != null)
                     {
                         foreach (var message in recentLog)
                         {
                            <li class="chat-message">
                                @message.TimeSend.Value.ToString("HH:mm:ss") <span class="chat-message-sender" style="font-weight:bold">@message.Sender.UserName</span>
                                @if (message.Recipient != null)
                                {
                                    <span class="chat-message-recipient" style="font-weight:bold">@@@message.Recipient.UserName</span>
                                }
                                @message.Message
                            </li>
                         }
                     }
                    }
                </ul>
            </div>

        </div>

    </div>

    <input type="checkbox" id="chat-messages-general-check" checked="checked"> General chat.
    <input type="checkbox" id="chat-messages-private-check" checked="checked"> Private chat.

</div>

@*----------------------------------------------------- SCRIPT -----------------------------------------------------*@
@Scripts.Render("~/bundles/jquerysignalR")
@Scripts.Render("~/signalr/hubs")
@Scripts.Render("~/Scripts/_chat.js")
@*@Scripts.Render("~/Scripts/_hub-start.js")*@
